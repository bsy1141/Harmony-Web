<!DOCTYPE html>
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" type="text/css" href="../style/search.css">
    <script src="http://code.jquery.com/jquery-latest.js"></script>
</head>
<body>
    <div class="top">
        <button class="harmony">
            <img src="../assets/image/icon8.png" class="harmony_logo">
        </button>
        <input type="text" class="find" id="tag" placeholder="     검색">
        <button class="findbtn">
            <img src="../assets/image/icon10.png" class="findbtnimg">
        </button>
        <button id="btn" class="write_post">게시글 작성</button>
        <button id="btn" class="mypage">마이페이지</button>
        <button id="btn" class="bookmark">북마크</button>
        <button class="alarm">
            <img src="../assets/image/icon7.png" class="alarm_photo">
        </button>
        <div id="prof_photo" class="photo1">
            <img src="../assets/image/icon9.png" class="human">
        </div>
        <div class="prof_name">김유민</div>
    </div>

    <div class="search_page">
        <div class="sp_title">검색결과</div>

       <ul id="tag-list"></ul>
        
        <div class="result1"></div>
        <div class="result2"></div>
        <div class="result3"></div>
        <div class="result4"></div>
        <div class="result5"></div>
        <div class="result6"></div>
        <div class="result7"></div>
    </div>

    <div class="alarm_page" style="display:none"></div>

    <script>
        $(function(){
            $(".alarm").click(function(e){
                e.stopPropagation();
                $(".alarm_page").show();
            });

            $(document).click(function() {
                $(".alarm_page").hide();
            }) 
        });

        $(document).ready(function () {
    
            var tag = {};
            var counter = 0;

            // 태그를 추가한다.
            function addTag (value) {
                tag[counter] = value; // 태그를 Object 안에 추가
                counter++; // counter 증가 삭제를 위한 del-btn 의 고유 id 가 된다.
            }

            $("#tag").on("keypress", function (e) {
                var self = $(this);

                // input 에 focus 되있을 때 엔터 및 스페이스바 입력시 구동 + 버튼 클릭 가능하게 추가하고 싶음
                if (e.key === "Enter" || e.keyCode == 32) {

                    var tagValue = self.val(); // 값 가져오기

                    // 값이 없으면 동작 ㄴㄴ
                    if (tagValue !== "") {

                        // 같은 태그가 있는지 검사한다. 있다면 해당값이 array 로 return 된다.
                        var result = Object.values(tag).filter(function (word) {
                            return word === tagValue;
                        })
                    
                        // 태그 중복 검사
                        if (result.length == 0) { 
                            $("#tag-list").append("<li class='tag-item'>"+tagValue+"<span class='del-btn' idx='"+counter+"'>x</span></li>");
                            addTag(tagValue);
                            self.val("");
                        } else {
                            alert("태그값이 중복됩니다.");
                        }
                    }
                    e.preventDefault(); // SpaceBar 시 빈공간이 생기지 않도록 방지
                }
            });

            // 삭제 버튼 
            // 삭제 버튼은 비동기적 생성이므로 document 최초 생성시가 아닌 검색을 통해 이벤트를 구현시킨다.
            $(document).on("click", ".del-btn", function (e) {
                var index = $(this).attr("idx");
                tag[index] = "";
                $(this).parent().remove();
            });
        })
    </script>
</body>
